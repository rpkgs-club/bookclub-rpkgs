---
title: "Creating R package -- first steps"
output:
  html_document:
    df_print: paged
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  # fig.path = "figures/README-",
  out.width = "100%"
)

`%>%` <- purrr::`%>%`
```

## More info...

* Package structure and state. 
[4.7 Package libraries](https://r-pkgs.org/package-structure-state.html#library).
* [Comparison of `fs` functions, base R, and shell commands](https://cran.r-project.org/web/packages/fs/vignettes/function-comparisons.html)


## Managing package libraries

Here are the main two levers that control which libraries
are active, in order of scope and persistence:

1. Environment variables, like `R_LIBS` and `R_LIBS_USER`,
which are consulted at startup.
1. Calling `.libPaths()` with one or more filepaths.

```sh
mkdir -p ~/Library/R/4.0/library
```

```{sh}
cat ~/.Rprofile.site
```

```{sh}
echo $R_LIBS_USER
```

```{r}
.Library
.Library.site
```

In both cases we see two active libraries, consulted in this order:

1. A user library.
1. A system-level or global library.

```{r}
.libPaths()
```

```{r}
lapply(
  .libPaths(), 
  list.dirs, 
  recursive = FALSE, 
  full.names = FALSE)
```


## Check what is installed

```{r message=FALSE, warning=FALSE}
packageVersion("devtools")

options(buildtools.check = NULL)
# devtools::install_github("r-lib/devtools")
# packageVersion("devtools")
```

Optionally run:

```{r}
# tidyverse::tidyverse_update()
# tidyverse::tidyverse_conflicts()
tidyverse::tidyverse_packages()
```


## [Create package](https://r-pkgs.org/workflows101.html#create-a-package)

```{r}
library(devtools)
library(tidyverse)
library(fs)
```

### Name your package

TODO.





```{r}
# ?fs::dir_info

fs::dir_info(
    all = TRUE, 
    regexp = "^[.]git$",
    invert = TRUE) %>% 
  dplyr::select(path, type)
```

```{r}
package_name <- "xfoo"

pkg_path <- fs::path(.libPaths()[[1]], package_name)
src_path <- fs::path("~/RRR/GUMED", "package_name)
```

```{r}
# usethis::create_package(?)
```











## TODO

```{r}
fs::dir_info(recurse = TRUE) %>%
  dplyr::filter(
    type == "file",
    permissions == "u+r",
    size > "10KB") %>%
  dplyr::arrange(
    desc(size)) %>%
  dplyr::select(
    path, permissions, size, modification_time
  )
```

